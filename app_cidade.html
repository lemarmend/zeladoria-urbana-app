<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Zeladoria Urbana Pro</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <style>
        body { overflow: hidden; background-color: #f0f2f5; font-family: 'Segoe UI', sans-serif; }
        #map { height: 100vh; width: 100%; position: absolute; top: 0; left: 0; z-index: 1; }
        
        .navbar-custom {
            position: fixed; top: 10px; left: 50%; transform: translateX(-50%);
            width: 95%; max-width: 600px;
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(5px);
            border-radius: 50px; box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            z-index: 1000; padding: 0.5rem 1rem;
        }

        .fab {
            position: fixed; bottom: 30px; right: 20px;
            width: 65px; height: 65px;
            background: linear-gradient(135deg, #d32f2f, #b71c1c);
            color: white; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 12px rgba(211, 47, 47, 0.5);
            cursor: pointer; z-index: 1000; transition: transform 0.2s;
        }
        .fab:active { transform: scale(0.95); }

        #loginOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #263238; z-index: 9999;
            display: flex; align-items: center; justify-content: center;
            flex-direction: column; overflow-y: auto;
        }

        .custom-marker {
            display: flex; align-items: center; justify-content: center;
            background: white; border-radius: 50%;
            box-shadow: 0 3px 6px rgba(0,0,0,0.3);
            font-size: 20px; width: 35px; height: 35px;
        }
    </style>
</head>
<body>

    <div id="loginOverlay">
        <div class="text-center p-4 bg-white rounded-4 shadow" style="max-width: 400px; width: 90%;">
            <div class="mb-3">
                <span class="material-icons text-primary" style="font-size: 50px;">location_city</span>
            </div>
            <h2 class="mb-4 fw-bold text-dark">Zeladoria App</h2>
            
            <div id="formLogin">
                <input type="email" id="emailLogin" class="form-control mb-3" placeholder="admin@city.com">
                <input type="password" id="senhaLogin" class="form-control mb-3" placeholder="Senha">
                <button onclick="fazerLoginReal()" class="btn btn-primary w-100 fw-bold mb-3">ENTRAR</button>
                <div class="text-muted small mb-3">- OU -</div>
                <button onclick="loginComFacebook()" class="btn btn-primary w-100 mb-3" style="background:#1877F2; border:none;">
                    Entrar com Facebook
                </button>
                <button onclick="alternarForms()" class="btn btn-sm btn-link text-decoration-none">Criar nova conta</button>
            </div>

            <div id="formCadastro" style="display:none;">
                <h5 class="mb-3">Nova Conta</h5>
                <input type="email" id="emailCad" class="form-control mb-2" placeholder="Seu Email">
                <input type="password" id="senhaCad" class="form-control mb-2" placeholder="Crie uma Senha">
                <select id="perfilCad" class="form-select mb-3">
                    <option value="cidadao">Sou Cidad√£o</option>
                    <option value="prefeitura">Sou da Prefeitura</option>
                </select>
                <button onclick="cadastrar()" class="btn btn-success w-100 fw-bold mb-2">CADASTRAR</button>
                <button onclick="alternarForms()" class="btn btn-sm btn-outline-secondary w-100">Voltar</button>
            </div>
        </div>
    </div>

    <nav class="navbar navbar-expand navbar-light navbar-custom" id="navBarApp" style="display:none;">
        <div class="container-fluid">
            <div class="d-flex align-items-center">
                <span class="material-icons text-primary me-2">account_circle</span>
                <span class="navbar-brand fw-bold fs-6 m-0" id="labelPerfil">CIDAD√ÉO</span>
            </div>
            
            <div>
                <button id="btnAdmin" class="btn btn-sm btn-dark me-2" style="display:none;" onclick="abrirAdmin()">
                    ‚öôÔ∏è Gerenciar
                </button>
                <button class="btn btn-sm btn-outline-danger" onclick="sair()">
                    <span class="material-icons" style="font-size:18px;">logout</span>
                </button>
            </div>
        </div>
    </nav>

    <div id="map"></div>

    <div class="fab" id="fabBtn" onclick="abrirRelato()" style="display:none;">
        <span class="material-icons" style="font-size: 32px;">add</span>
    </div>

    <div class="modal fade" id="modalRelato" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content rounded-4 border-0">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold">üì¢ O que aconteceu?</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="fw-bold form-label">Tipo de Problema</label>
                        <select id="tipoProblema" class="form-select form-select-lg">
                            <option>Carregando...</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="fw-bold form-label">Detalhes</label>
                        <textarea id="descricao" class="form-control" rows="3" placeholder="Ex: Buraco fundo..."></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label class="fw-bold form-label">Fotos (M√°x 3)</label>
                        <input type="file" id="fotosInput" class="form-control" accept="image/*" multiple>
                        <div class="form-text">Tire fotos do local para agilizar o atendimento.</div>
                    </div>
                    
                    <button class="btn btn-primary w-100 fw-bold" onclick="salvarRelato()">REPORTAR AGORA</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalAdmin" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content rounded-4">
                <div class="modal-header bg-dark text-white">
                    <h5 class="modal-title">‚öôÔ∏è Gest√£o de Tipos</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="card p-3 mb-4 bg-light border-0">
                        <h6 class="fw-bold">Novo Tipo de Ocorr√™ncia</h6>
                        <div class="row g-2">
                            <div class="col-3"><input id="newKey" class="form-control form-control-sm" placeholder="ID (ex: neve)"></div>
                            <div class="col-4"><input id="newTitle" class="form-control form-control-sm" placeholder="T√≠tulo (ex: Neve na Pista)"></div>
                            <div class="col-3">
                                <select id="newCat" class="form-select form-select-sm">
                                    <option>Infraestrutura</option><option>Seguran√ßa</option><option>Natureza</option><option>Limpeza</option><option>Sa√∫de</option>
                                </select>
                            </div>
                            <div class="col-1"><input id="newIcon" class="form-control form-control-sm" placeholder="‚ùÑÔ∏è"></div>
                            <div class="col-1"><button onclick="adminCriarTipo()" class="btn btn-sm btn-success w-100">+</button></div>
                        </div>
                    </div>
                    <table class="table align-middle">
                        <thead class="table-light"><tr><th>√çcone</th><th>Nome</th><th>Categoria</th><th>A√ß√£o</th></tr></thead>
                        <tbody id="listaTiposAdmin"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
      // SDK Facebook (Carregamento ass√≠ncrono b√°sico)
      (function(d, s, id){ var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = "https://connect.facebook.net/en_US/sdk.js"; fjs.parentNode.insertBefore(js, fjs); }(document, 'script', 'facebook-jssdk'));
    </script>
    
    <script src="/static/app.js"></script>

</body>
</html>